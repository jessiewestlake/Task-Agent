<!DOCTYPE html>
<html>
<head>
  <title>Gemini Chat</title>
  <link rel="stylesheet" href="index.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div id="app-container">
    <aside id="conversation-sidebar">
      <div class="sidebar-header">
        <button id="new-chat-button" class="sidebar-button" aria-label="Start new chat">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83zM3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg>
          <span>New Chat</span>
        </button>
        <button id="pin-sidebar-button" class="sidebar-button icon-button" aria-label="Pin sidebar">
          <svg class="pin-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1.03-1 1.03 1v-7H19v-2c-1.66 0-3-1.34-3-3z"/></svg>
        </button>
      </div>
      <div class="sidebar-search">
        <input type="text" id="search-input" placeholder="Search...">
      </div>
      <nav id="conversation-list-container">
        <ul id="conversation-list"></ul>
        <div id="archived-section" class="hidden">
          <h3 class="archive-header">Archived</h3>
          <ul id="archived-list"></ul>
        </div>
      </nav>
      <div class="sidebar-footer">
        <button id="tasks-button" class="sidebar-button" aria-label="Open tasks">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="m20.57 14.86-1.42-1.42a.51.51 0 0 1 0-.71l1.42-1.42a.51.51 0 0 0 0-.71l-1.42-1.42a.51.51 0 0 0-.71 0l-1.42 1.42a.51.51 0 0 1-.71 0L14.86 9.14a.51.51 0 0 0-.71 0l-1.42 1.42a.51.51 0 0 0 0 .71l1.42 1.42a.51.51 0 0 1 0 .71l-1.42 1.42a.51.51 0 0 0 0 .71l1.42 1.42a.51.51 0 0 0 .71 0l1.42-1.42a.51.51 0 0 1 .71 0l1.42 1.42a.51.51 0 0 0 .71 0l1.42-1.42a.51.51 0 0 0 0-.71zM5.34 7.06h8.32a.5.5 0 1 0 0-1H5.34a.5.5 0 1 0 0 1zm0 4h8.32a.5.5 0 1 0 0-1H5.34a.5.5 0 1 0 0 1zm0 4h5.32a.5.5 0 1 0 0-1H5.34a.5.5 0 1 0 0 1zM3 20.25A2.75 2.75 0 0 1 .25 17.5V6.5A2.75 2.75 0 0 1 3 3.75h14A2.75 2.75 0 0 1 19.75 6.5v3.16a.5.5 0 0 1-1 0V6.5c0-.97-.78-1.75-1.75-1.75H3c-.97 0-1.75.78-1.75 1.75v11c0 .97.78 1.75 1.75 1.75h11c.41 0 .79-.14 1.1-.38a.5.5 0 0 1 .65.76 2.74 2.74 0 0 1-1.75.62H3z"/></svg>
            <span>Tasks</span>
        </button>
        <button id="settings-button" class="sidebar-button" aria-label="Open settings">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
          <span>Settings</span>
        </button>
      </div>
    </aside>

    <main id="main-content">
      <div id="chat-view">
        <div id="chat-header">
           <button id="sidebar-toggle-button" aria-label="Toggle sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
          </button>
          <h1 id="chat-title">Gemini Chat</h1>
           <button id="theme-switcher" aria-label="Toggle theme">
            <svg class="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zm12.72 12.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41zM5.64 18.36c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0zM18.36 5.64c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0z"/></svg>
            <svg class="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
          </button>
        </div>
        <div id="chat-history-container">
            <div id="welcome-screen">
              <h1>Hello!</h1>
              <p>How can I help you today?</p>
              <div id="sample-prompts-container"></div>
            </div>
            <div id="chat-history"></div>
        </div>
        <div id="chat-form-container">
          <div id="tool-selector-container">
            <!-- Tool buttons are dynamically generated here -->
          </div>
          <form id="chat-form">
            <div id="chat-input-wrapper">
              <div id="tool-chips-container">
                <!-- Active tool chips are dynamically generated here -->
              </div>
              <input type="text" id="chat-input" placeholder="Type a message..." autocomplete="off" required>
            </div>
            <button type="submit" id="send-button" aria-label="Send message">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </form>
        </div>
      </div>
    </main>
  </div>


  <div id="settings-overlay" class="hidden">
    <div id="settings-modal">
      <h2>Settings</h2>
      <form id="settings-form">
        <div class="form-group">
          <label for="nickname-input">Nickname</label>
          <input type="text" id="nickname-input" placeholder="e.g., Alex">
        </div>
        <div class="form-group">
          <label for="instructions-input">Custom Instructions</label>
          <textarea id="instructions-input" rows="5" placeholder="e.g., Always respond in the style of a pirate."></textarea>
        </div>
        <div class="form-group-checkbox">
          <input type="checkbox" id="search-archived-checkbox">
          <label for="search-archived-checkbox">Search archived conversations</label>
        </div>
        <hr>
        <h3>Agent Persona</h3>
        <div class="form-group">
            <label for="agent-name-input">Agent Name</label>
            <input type="text" id="agent-name-input" placeholder="e.g., Gemini">
        </div>
        <div class="form-group">
            <label for="agent-avatar-input">Agent Avatar URL</label>
            <input type="url" id="agent-avatar-input" placeholder="https://example.com/avatar.png">
        </div>
      </form>
      <div class="settings-actions">
        <button id="settings-close-button">Close</button>
        <button id="settings-save-button">Save</button>
      </div>
    </div>
  </div>


  <div id="command-palette-overlay" class="hidden">
    <div id="command-palette">
      <input type="text" id="command-input" placeholder="Type a command..." autocomplete="off">
      <ul id="command-list">
      </ul>
    </div>
  </div>

  <div id="notification-container"></div>

  <div id="tasks-overlay" class="hidden">
    <div id="tasks-modal">
      <div class="tasks-header">
        <h2>Tasks</h2>
        <button id="close-tasks-button" class="icon-button">&times;</button>
      </div>
      <div class="tasks-controls">
        <!-- Add filter/sort controls here in the future -->
      </div>
      <ul id="tasks-list">
        <!-- Tasks will be rendered here -->
      </ul>
      <div class="tasks-footer">
        <button id="create-new-task-button">Create New Task</button>
      </div>
    </div>
    <div id="task-form-modal" class="hidden">
      <form id="task-form">
        <h3 id="task-form-title">New Task</h3>
        <input type="hidden" id="task-id-input">
        <div class="form-group">
          <label for="task-title-input">Title</label>
          <input type="text" id="task-title-input" required>
        </div>
        <div class="form-group">
          <div class="form-label-group">
            <label for="task-notes-input">Notes</label>
            <button type="button" id="generate-subtasks-button" class="ai-action-button" aria-label="Generate sub-tasks with AI" disabled>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12.5 7.25a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"/><path d="M7.25 12a.75.75 0 0 0 0-1.5h-4.5a.75.75 0 0 0 0 1.5h4.5ZM19.25 12a.75.75 0 0 0 0-1.5h-4.5a.75.75 0 0 0 0 1.5h4.5ZM12 19.25a.75.75 0 0 0-.75-.75v-4.5a.75.75 0 0 0-1.5 0v4.5a.75.75 0 0 0 1.5 0a.75.75 0 0 0 .75-.75ZM12 4.75a.75.75 0 0 0 .75.75v4.5a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-1.5 0A.75.75 0 0 0 12 4.75Z"/></svg>
              <span>Generate Sub-tasks</span>
            </button>
          </div>
          <textarea id="task-notes-input" rows="4"></textarea>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="task-status-select">Status</label>
                <select id="task-status-select">
                    <option value="todo">To Do</option>
                    <option value="in-progress">In Progress</option>
                    <option value="done">Done</option>
                </select>
            </div>
            <div class="form-group">
                <label for="task-priority-select">Priority</label>
                <select id="task-priority-select">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
        </div>
        <div class="form-group">
          <label for="task-due-date-input">Due Date</label>
          <input type="date" id="task-due-date-input">
        </div>
        <a href="#" id="task-form-source-link" target="_blank" rel="noopener noreferrer" class="hidden">
          View source conversation
        </a>
        <div class="task-form-actions">
          <button type="button" id="task-delete-button" class="hidden">Delete</button>
          <div class="task-form-actions-right">
            <button type="button" id="task-cancel-button">Cancel</button>
            <button type="submit" id="task-save-button">Save Task</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
        "marked": "https://esm.sh/marked@^9.0.0",
        "dompurify": "https://esm.sh/dompurify@^3.0.0"
      }
    }
  </script>
  <script type="module" src="index.tsx"></script>
</body>
</html>